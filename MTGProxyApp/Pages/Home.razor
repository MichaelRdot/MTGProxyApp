@page "/"
@rendermode InteractiveServer

@using MTGProxyApp.Services

@inject ScryfallService ScryfallService
@inject QuestPdfService QuestPdfService
@inject HttpService HttpService
@inject ISnackbar Snackbar
@inject IJSRuntime Js

<MudContainer MaxWidth="MaxWidth.Large">
    <MudImage Fluid ObjectFit="ObjectFit.ScaleDown" ObjectPosition="ObjectPosition.Center" Src="Images/MichaelProxiesBanner.png"/>
</MudContainer>
<MudContainer MaxWidth="MaxWidth.Large">
    <MudGrid Justify="Justify.SpaceBetween">
        <MudItem xs="12">
            <MudTextField @bind-Value="_deckTextField" Variant="Variant.Outlined" Lines="10" Label="@_deckTextFieldLabel"
                          HelperText="@_deckTextFieldHelperText" Placeholder="@_deckTextFieldPlaceholderText"/>
        </MudItem>
        <MudItem xs="12">
            <MudButton Variant="Variant.Filled" Color="Color.Dark" OnClick="@Load" Class="d-flex align-center justify-center mud-width-full py-8">Load</MudButton>
        </MudItem>
        <MudItem xs="12">
            <MudTextField @bind-Value="_deckName" Variant="Variant.Outlined" Lines="1" Label="@_deckNameLabel"
                          HelperText="@_deckNameHelperText" Placeholder="@_deckNamePlaceholderText"/>
        </MudItem>
        <MudItem xs="12" sm="4">
            <MudButton Variant="Variant.Filled" Color="Color.Dark" StartIcon="@_blackCornersToggleIcon"
                       OnClick="@BlackCornersToggle" Class="d-flex align-center justify-center mud-width-full py-8">Black Corners
            </MudButton>
        </MudItem>
        <MudItem xs="12" sm="4">
            <MudButton Variant="Variant.Filled" Color="Color.Dark" StartIcon="@_bordersToggleIcon" OnClick="@BordersToggle" Class="d-flex align-center justify-center mud-width-full py-8">
                Borders
            </MudButton>
        </MudItem>
        <MudItem xs="12" sm="4">
            <MudButton Variant="Variant.Filled" Color="Color.Dark" StartIcon="@_printFlipCardsSeparateToggleIcon" OnClick="@PrintFlipCardsSeparateToggle" Class="d-flex align-center justify-center mud-width-full py-8">
                Print Flip Cards Separate
            </MudButton>
        </MudItem>
        <MudItem xs="12">
            <MudButton Variant="Variant.Filled" Color="Color.Dark" OnClick="@Download" Class="d-flex align-center justify-center mud-width-full py-8">Download</MudButton>
        </MudItem>
        <MudItem xs="12">
            <MudTextField @bind-Value="_deckTooltip" ReadOnly Label="Tooltip" Typo="Typo.body1" Variant="Variant.Outlined" Lines="1" HelperText="@_toolTipHelperText"/>
        </MudItem>
    </MudGrid>
    <MudFlexBreak />
    <MudDivider />
</MudContainer>
<MudGrid Spacing="4" Justify="Justify.FlexStart">
    @foreach (var card in _cards)
    {
        <MudCardCard Card="@card" UpdatedCard="OnCardUpdated" @key="card"/>
    }
</MudGrid>
<MudOverlay Visible="@(_creatingDocument || _loadingCards)" DarkBackground>
    <MudPaper Class="pa-6 d-flex flex-column align-center justify-center" Elevation="3">
        @if (_creatingDocument)
        {
            <MudText Typo="Typo.h6">Creating PDF…</MudText>
            <MudProgressCircular Color="Color.Primary" Value="@_cardsPrintedValue" Max="100" Size="Size.Large">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2">@_cardsPrintedValue.ToString("0")%</MudText>
                </ChildContent>
            </MudProgressCircular>
        }
        else if (_loadingCards)
        {
            <MudText Typo="Typo.h6">Loading cards… @_loadingValue.ToString("0")%</MudText>
            <MudProgressCircular Color="Color.Primary" Value="@_loadingValue" Max="100" Size="Size.Large">
                <ChildContent>
                    <MudText Typo="Typo.subtitle2">@_loadingValue.ToString("0")%</MudText>
                </ChildContent>
            </MudProgressCircular>
        }
    </MudPaper>
</MudOverlay>